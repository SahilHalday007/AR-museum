<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>AR Penguin Explorer</title>

  <!-- A-Frame + AR.js + Extras -->
  <script src="public/aframe-v1.7.0.min.js"></script>
  <script src="public/aframe-extras-v7.2.0.min.js"></script>
  <script src="public/aframe-ar.js"></script>
  
  <!-- Gesture Detection Components -->
  <script src="public/gesture-detector.js"></script>
  <script src="public/gesture-handler.js"></script>

  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <h1> AR Penguin Explorer</h1>
    <p>Initializing AR camera and marker detection...</p>
    <div class="spinner"></div>
  </div>

<!-- UI Overlay -->
    <div class="ui-overlay">
        <div class="top-bar">
            African Penguin AR Experience
        </div>

        <div class="instructions" id="instructions">
            Point your camera at the marker and tap the info button to learn about the African penguins!
        </div>

        <div class="bottom-controls">
            <button class="control-btn" id="infoBtn" title="Penguin Information">
                ‚ÑπÔ∏è
            </button>
            <button class="control-btn" id="resetBtn" title="Reset View">
                üîÑ
            </button>
        </div>

        <!-- Info Panel -->
        <div class="info-panel" id="infoPanel">
            <button class="close-btn" id="closeBtn">√ó</button>
            <div id="infoContent">
                <h3>African Penguin Facts</h3>
                <div class="info-nav">
                    <button class="nav-btn" data-info="general">General</button>
                    <button class="nav-btn" data-info="habitat">Habitat</button>
                    <button class="nav-btn" data-info="behavior">Behavior</button>
                </div>
                <div id="infoText"></div>
            </div>
        </div>
    </div>


  <!-- AR Scene -->
  <a-scene
      embedded
      arjs="sourceType: webcam;"
      renderer="logarithmicDepthBuffer: true; antialias: true; alpha: true;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene"
    >
    
    <!-- Assets -->
    <a-assets>
      <!-- Penguin 3D Model -->
      <a-asset-item id="penguin-model" src="assets/african_penguin_spheniscus_demersus_low_poly.glb"></a-asset-item>
    </a-assets>

    <!-- Camera -->
    <a-entity camera position="0 0 0" look-controls="enabled: false"></a-entity>

    <!-- Hiro Marker -->
    <a-marker 
        preset="hiro" 
        id="hiro-marker" 
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;">
        
        <a-entity
          id="penguin"
          gltf-model="#penguin-model"
          position="0 0 0"
          rotation="-90 0 0"
          scale="5 5 5" 
          animation-mixer="loop: repeat"
          class="clickable"
          gesture-handler>
        </a-entity>


      <!-- Lights -->
      <a-light type="ambient" color="#ffffff" intensity="0.8"></a-light>
      <a-light type="directional" position="0 5 0" color="#ffffff" intensity="0.6"></a-light>
    </a-marker>

  </a-scene>

  <div id="cameraError" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; background: rgba(0, 0, 0, 0.8); padding: 20px; border-radius: 10px; z-index: 2000;">
    <p>Unable to access the camera. Please ensure camera permissions are enabled and reload the page.</p>
  </div>

  <script type="module" src="script.js"></script>
  <script>
    const scene = document.querySelector('a-scene');
    scene.addEventListener('arjs-video-loaded', () => {
      document.getElementById('cameraError').style.display = 'none';
    });

    scene.addEventListener('arjs-video-error', () => {
      document.getElementById('cameraError').style.display = 'block';
    });
  </script>
</body>
</html>